var dependencies=["ui.router","ui.bootstrap","ngStorage","ngResource"],kgroups=angular.module("kgroups",dependencies);kgroups.run(["$rootScope","$http","$location","$localStorage",function(e,r,o,s){s.token&&(r.defaults.headers.common["x-access-token"]=s.token),e.$on("$locationChangeStart",function(e,r,t){var l=["/","/login","/login-failed","/auth"],n="/"+o.path().split("/")[1];-1===l.indexOf(n)&&!s.token&&o.path("/login")}),e.$on("$stateChangeSuccess",function(e,r,o,s,t){$state.current=r})}]),kgroups.config(["$httpProvider",function(e){e.interceptors.push("ResponseObserver")}]);var AuthController=function(e,r,o,s){var t=o.token;console.log(t),s.token=t,r.url("/progress")};AuthController.$inject=["$scope","$location","$stateParams","$localStorage"],kgroups.controller("AuthController",AuthController);var ResponseObserver=function(e,r){return{responseError:function(o){switch(o.status){case 403:console.log("API Access denied"),r.path("/login")}return e.reject(o)}}};ResponseObserver.$inject=["$q","$location"],kgroups.factory("ResponseObserver",ResponseObserver);var CourseConfigController=function(e,r){};CourseConfigController.$inject=["$scope","Course"],kgroups.controller("CourseConfigController",CourseConfigController);var CourseController=function(e,r,o){var s=r.courseId;e.course=o.get({id:s}),e.clusters=o.clusters({id:s}),e.addTask=function(r){e.course.tasks.splice(e.course.tasks.indexOf(r)+1,0,{}),console.log(e.course.tasks),e.course.tasks.join()},e.saveCourse=function(e){e.$save()}};CourseController.$inject=["$scope","$stateParams","Course"],kgroups.controller("CourseController",CourseController);var CourseCreateController=function(e,r){e.tasks=[{}],e.date=null,e.addTask=function(r){e.tasks.splice(e.tasks.indexOf(r)+1,0,{}),console.log(e.tasks),e.tasks.join()};new Date,r.query({id:"594c6615891d97c705128118"}).$promise.then(function(e){console.log(e)});e.createCourse=function(o){o.tasks=e.tasks,new r(o).$save(function(e){console.log(e)})}};CourseCreateController.$inject=["$scope","Course"],kgroups.controller("CourseCreateController",CourseCreateController);var CourseIndexController=function(e,r,o){e.courses=o.query()};CourseIndexController.$inject=["$scope","$stateParams","Course"],kgroups.controller("CourseIndexController",CourseIndexController);var CourseMemberController=function(e,r,o){var s=r.courseId;e.course=o.get({id:s})};CourseMemberController.$inject=["$scope","$stateParams","Course"],kgroups.controller("CourseMemberController",CourseMemberController);var CourseTaskController=function(e,r,o){var s=r.courseId;console.log(s),e.course=o.get({id:s}),e.addTask=function(r){e.course.tasks.splice(e.course.tasks.indexOf(r)+1,0,{}),console.log(e.course.tasks),e.course.tasks.join()},e.saveCourse=function(e){e.$save()}};CourseTaskController.$inject=["$scope","$stateParams","Course"],kgroups.controller("CourseTaskController",CourseTaskController);var courseNav=function(){return{templateUrl:"app/modules/course/directives/courseNav/courseNav.html",controller:["$scope","$state",function(e,r){e.page=r.current.name,e.$watch("page",function(r,o){o!==r&&(e.page=o)}),console.log(e.page)}]}};kgroups.directive("courseNav",courseNav);var Course=function(e){return e("/api/course/:id",{id:"@_id"},{enrolled:{method:"GET",isArray:!0,url:"/api/course/enrolled"},clusters:{method:"GET",isArray:!0,url:"/api/cluster/:id"}})};Course.$inject=["$resource"],kgroups.service("Course",Course);var topNav=function(){return{templateUrl:"app/modules/navs/directives/topNav/topNav.html"}};kgroups.directive("topNav",topNav);var ProgressController=function(e,r,o,s,t){var l=r.courseId,n=!1,a=function(e,r){if(r)for(var o=0;o<r.length;o++)if(r[o].taskId===e)return r[o];return!1};t.get({id:l}).$promise.then(function(r){e.course=r,s.get({id:l}).$promise.then(function(o){e.progress=o;for(var s=0;s<r.tasks.length;s++){var t=a(r.tasks[s]._id,o.tasks);console.log(t),r.tasks[s].status=t?t.status:"Not Started"}})}),e.updateStatus=function(e){switch(n=!0,e.status){case void 0:case"Not Started":e.status="In Progress";break;case"In Progress":e.status="Completed";break;case"Completed":default:e.status="Not Started"}};o(function(){if(n){for(var r=[],o=0;o<e.course.tasks.length;o++){var s=e.course.tasks[o]._id,t=e.course.tasks[o].status;void 0===t&&(t="Not Started"),r.push({taskId:s,status:t}),e.progress.tasks=r}void 0===e.progress._id&&(e.progress.course=e.course._id),console.log(e.progress),e.progress.$save(),n=!1}},500)};ProgressController.$inject=["$scope","$stateParams","$interval","Progress","Course"],kgroups.controller("ProgressController",ProgressController);var ProgressIndexController=function(e,r,o){e.reports=r.query(),e.courses=o.enrolled()};ProgressIndexController.$inject=["$scope","Progress","Course"],kgroups.controller("ProgressIndexController",ProgressIndexController);var Progress=function(e){return e("/api/progress/:id",{id:"@_id"})};Progress.$inject=["$resource"],kgroups.service("Progress",Progress),kgroups.config(["$stateProvider",function(e){var r={name:"courseIndex",url:"/course",templateUrl:"app/modules/course/views/index.html",controller:"CourseIndexController"},o={name:"courseCreate",url:"/course/create",templateUrl:"app/modules/course/views/create.html",controller:"CourseCreateController"},s={abstract:!0,name:"course",url:"/course/:courseId",templateUrl:"app/modules/course/views/template.html"},t={name:"course.task",url:"/task",templateUrl:"app/modules/course/views/task.html",controller:"CourseTaskController"},l={name:"course.member",url:"/member",templateUrl:"app/modules/course/views/member.html",controller:"CourseMemberController"},n={name:"course.config",url:"/config",templateUrl:"app/modules/course/views/config.html",controller:"CourseController"},a={name:"course.cluster",url:"/cluster",templateUrl:"app/modules/course/views/cluster.html",controller:"CourseController"};e.state(o),e.state(r),e.state(s),e.state(t),e.state(l),e.state(n),e.state(a)}]),kgroups.config(["$stateProvider","$urlRouterProvider",function(e,r){var o={name:"about",url:"/",templateUrl:"app/modules/external/views/about.html"},s={name:"login",url:"/login",templateUrl:"app/modules/external/views/login.html"},t={name:"signin-failed",url:"/signin-failed",templateUrl:"app/modules/external/views/signin-failed.html"};e.state(o),e.state(s),e.state(t),r.otherwise("/")}]),kgroups.config(["$stateProvider",function(e){var r={name:"profile",url:"/profile",templateUrl:"app/modules/user/views/profile.html",controller:"ProfileController"},o={name:"authed",url:"/auth/:token",controller:"AuthController"};e.state(r),e.state(o)}]),kgroups.config(["$stateProvider",function(e){var r={name:"progressIndex",url:"/progress",templateUrl:"/app/modules/progress/views/index.html",controller:"ProgressIndexController"},o={name:"progressView",url:"/progress/:courseId",templateUrl:"app/modules/progress/views/view.html",controller:"ProgressController"};e.state(r),e.state(o)}]);var ProfileController=function(e,r,o){console.log(o.token),e.user=r.get()};ProfileController.$inject=["$scope","User","$localStorage"],kgroups.controller("ProfileController",ProfileController);var User=function(e){return e("/api/me")};User.$inject=["$resource"],kgroups.service("User",User);